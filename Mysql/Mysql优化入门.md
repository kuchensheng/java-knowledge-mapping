# Mysql优化入门

# 一、高并发如何优化
+ 如果请求太多，判定web服务器的压力过大，增加前端web服务器，做负载均衡
+ 如果请求静态界面不卡，但是动态数据还是卡，说明MySQL处理的请求太多了，在应用层增加缓存
+ 数据库其实是最脆弱的一层，一般在应用设计时在上游就需要把请求拦截掉，数据库层只承担“能力范围内”的访问请求，所以我们通过在服务层引入队列（MQ）和缓存，让最底层的数据库高枕无忧。但是如果请求激增，还是有大量的查询压力到MySQL，这个时候就要想办法解决MySQL的瓶颈了。
 
**总结：**系统优化的第一步，是绝对轮不到MySQL优化，我们之所以要做MySQL的集群，一般都是在做好了应用级别的缓存，请求还是太多的情况下考虑的问题。

# 二、MySQL的执行流程

![MySQL执行流程](../imgs/mysql_plan.jpg)

大致可以分为以下七个步骤：

* 1.当我们请求MySQL服务器的时候，MySQL前端会有一个监听，请求到了之后，服务器得到相关的SQL语句，执行之前，还会做权限判断
* 2.权限通过后，SQL就到MySQL内部查询缓存，看看该SQL有没有执行过，如果有，则把缓存返回。MySQL内部的缓存是**默认不开启**。因为查询缓存要求SQL和参数都要一样，所以这个**缓存命中率很低（没啥用）**。
* 3.如果没有开启查询缓存，或者缓存没有命中，name就到了解析器，解析器主要对SQL语法进行解析
* 4.解析接收后，得到解析树。这个时候还不能执行，要对这棵树进行预处理。预处理完毕后，得到比较规范的树，这棵树就是要马上去执行的树，比起之前的解析树得到了一些优化。
* 5.**优化查询器，是MySQL里面最关键的东西**。我们写一条SQL，比如SELECT * FROM USER WHERE USERNAME=myName AND PASSWORD= '123456';
它会怎么执行？它是先执行USERNAME=myName还是PASSWORD= '123456'?每一条SQL的执行顺序查询优化器就是根据MySQL对数据统计表的一些信息,比如索引,比如表一共有多少数据,MySQL都是有缓存起来的,在真正执行SQL之前,他会根据自己的这些数据,进行一个综合的判定,判断这一次在多种执行方式里面,到底选哪一种执行方式,可能运行的最快.这一步是MySQL性能中,最关键的核心点,也是我们的优化原则.**优化SQL说白了，就是让查询优化器按照我们的想法帮我们选择最优的方案**
* 6.优化查询器生成查询计划，这个查询计划会传递查询执行引擎，执行引擎选择存储引擎来执行这一份过来的计划。这个时候影响查询性能的最根本原因是**硬盘的机械运动，也就是IO**，所以一条查询语句的快慢，就是根据这个IO来确定的。
* 7.如果开了查询缓存，则返回结果给客户端，并且查询缓存也放一份

# 三、索引
## 3.1 什么是索引
索引是存储引擎用来快速查找到记录的一种数据结构。**索引优化**应该是对查询性能优化最有效的手段了。
## 3.2 索引的类型
在MySQL中，索引是在存储引擎层而不是服务器层实现的，所以并没有统一的索引标准。
### 3.2.1 B-Tree索引
如果没有特别指明，一般的索引就是B-Tree索引。
