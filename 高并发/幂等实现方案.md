# 一、再提幂等
我们实际系统中有很多操作，是不管做多少次，都应该产生一样的效果或返回一样的结果。  例如：

1. 前端重复提交选中的数据，应该后台只产生对应这个数据的一个反应结果。 
2. 我们发起一笔付款请求，应该只扣用户账户一次钱，当遇到网络重复或者系统bug重发，也应该只扣一次钱
3. 发送消息也应该只发送一次
4. 创建业务订单，一次业务只能创建一个

这些情况，都需要幂等的特性来支持

# 二、幂等性概念
一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同。

幂等函数，或幂等方法，是指可以使用相同参数重复执行，并能获得相同结果的函数。

这些函数不会影响系统状态，也不用担心重复执行会对系统造成改变。例如SELECT执行属于天然幂等

幂等：就是一个操作，无论执行多少次，产生的效果和返回的结果都是一样的。

# 三、技术方案
1. 查询操作

查询一次和查询多次，在数据不变的情况下，查询结果是一样的。select是天然的幂等操作

2. 删除操作

删除操作也是幂等的，删除一次和多次删除都是把数据删除。

3. 唯一索引，防止新增脏数据

比如：每个用户只能有一个资金账户，怎么防止给用户创建多个资金账户，那么给资金账户中的用户ID加唯一索引，所以一个用户智能创建成功一个资金账户。

**但是：**当表存在唯一索引时，并发新增报错，需要再查一次，数据已经存在了，返回结果即可。

4. token机制，防止页面重复提交。

页面的数据只能被点击提交一次。由于重复点击或者网络原因，或者nginx重发会导致数据被重复提交。

解决方法：采用token + redis（redis是单线程，处理需要排队）。

数据在提交前要先向服务申请token，token放到redis，并设置token的有效期。提交后，验证token，同时删除token并返回新的token。
